# Data Flow

This document describes the data flow of the application.

## Table of Content

* [Visual Flow Chart](#visual-flow-chart): Visual Flow Chart.

## Visual Flow Chart

```mermaid
flowchart LR;

subgraph WEB_CLIENT[Web Client]
end

WEB_CLIENT <--->|http request| EXCHANGE_ENGINE
WEB_CLIENT <--->|ws subscription| WEBSOCKET_BROKER

subgraph KAFKA_AUDIT_TRAIL_TOPIC[Audit Trail]
KAFKA_AUDIT_TRAIL_TOPIC_PARTITION_1[Partition 1] -.- KAFKA_AUDIT_TRAIL_TOPIC_PARTITION_N[Partition... N]
end

subgraph KAFKA_TOP_OF_BOOK_TOPIC[Top of Book]
KAFKA_TOP_OF_BOOK_TOPIC_PARTITION_1[Partition 1] -.- KAFKA_TOP_OF_BOOK_TOPIC_PARTITION_N[Partition.. N]
end

subgraph KAFKA_REFERENCE_DATA_TOPIC[Reference Data]
KAFKA_REFERENCE_DATA_TOPIC_PARTITION_1[Partition 1] -.- KAFKA_REFERENCE_DATA_TOPIC_PARTITION_N[Partition... N]
end

KAFKA_AUDIT_TRAIL_TOPIC -->|kafka subscription|EXCHANGE_ENGINE
KAFKA_TOP_OF_BOOK_TOPIC -->|kafka subscription|EXCHANGE_ENGINE
KAFKA_REFERENCE_DATA_TOPIC -->|kafka subscription|EXCHANGE_ENGINE
subgraph EXCHANGE_ENGINE[Exchange Engine]
end

EXCHANGE_ENGINE -->|Events|SHADOW_ORDERBOOK_HANDLER
subgraph SHADOW_ORDERBOOK_HANDLER[Shadow Orderbook Handler]
SHADOW_ORDERBOOK_HANDLER_PARTITION_1[Partition 1] -.- SHADOW_ORDERBOOK_HANDLER_PARTITION_2[Partition... N]
end

SHADOW_ORDERBOOK_HANDLER --> WS_TRADES
subgraph WS_TRADES[Trades]
end

SHADOW_ORDERBOOK_HANDLER --> WS_TOP_OF_BOOK
subgraph WS_TOP_OF_BOOK[Top of Book]
end

SHADOW_ORDERBOOK_HANDLER --> WS_MARKET_BY_LEVEL
subgraph WS_MARKET_BY_LEVEL[Market by Level]
end

SHADOW_ORDERBOOK_HANDLER --> WS_ORDER_EVENTS
subgraph WS_ORDER_EVENTS[Order Events]
end

SHADOW_ORDERBOOK_HANDLER --> WS_STATE_CHANGES
subgraph WS_STATE_CHANGES[State Changes]
end

WS_TRADES ---> WEBSOCKET_BROKER
WS_TOP_OF_BOOK ---> WEBSOCKET_BROKER
WS_MARKET_BY_LEVEL ---> WEBSOCKET_BROKER
WS_ORDER_EVENTS ---> WEBSOCKET_BROKER
WS_STATE_CHANGES ---> WEBSOCKET_BROKER

subgraph WEBSOCKET_BROKER[Websocker Broker]
end
```
